// tributejs@5.1.3 downloaded from https://ga.jspm.io/npm:tributejs@5.1.3/dist/tribute.min.js

var o="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var u={};!function(o,l){u=l()}(u,(function(){function e(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")}function t(o,u){for(var l=0;l<u.length;l++){var s=u[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}function n(o,u,l){return u&&t(o.prototype,u),l&&t(o,l),o}function i(o,u){return function(o){if(Array.isArray(o))return o}(o)||function(o,u){if(Symbol.iterator in Object(o)||"[object Arguments]"===Object.prototype.toString.call(o)){var l=[],s=!0,a=!1,c=void 0;try{for(var h,d=o[Symbol.iterator]();!(s=(h=d.next()).done)&&(l.push(h.value),!u||l.length!==u);s=!0);}catch(o){a=!0,c=o}finally{try{s||null==d.return||d.return()}finally{if(a)throw c}}return l}}(o,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}if(Array.prototype.find||(Array.prototype.find=function(u){if(null===(this||o))throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof u)throw new TypeError("predicate must be a function");for(var l,s=Object(this||o),a=s.length>>>0,c=arguments[1],h=0;h<a;h++)if(l=s[h],u.call(c,l,h,s))return l}),window&&"function"!=typeof window.CustomEvent){var r=function(o,u){u=u||{bubbles:!1,cancelable:!1,detail:void 0};var l=document.createEvent("CustomEvent");return l.initCustomEvent(o,u.bubbles,u.cancelable,u.detail),l};void 0!==window.Event&&(r.prototype=window.Event.prototype),window.CustomEvent=r}var u=function(){function t(u){e(this||o,t),(this||o).tribute=u,(this||o).tribute.events=this||o}return n(t,[{key:"bind",value:function(u){u.boundKeydown=(this||o).keydown.bind(u,this||o),u.boundKeyup=(this||o).keyup.bind(u,this||o),u.boundInput=(this||o).input.bind(u,this||o),u.addEventListener("keydown",u.boundKeydown,!1),u.addEventListener("keyup",u.boundKeyup,!1),u.addEventListener("input",u.boundInput,!1)}},{key:"unbind",value:function(o){o.removeEventListener("keydown",o.boundKeydown,!1),o.removeEventListener("keyup",o.boundKeyup,!1),o.removeEventListener("input",o.boundInput,!1),delete o.boundKeydown,delete o.boundKeyup,delete o.boundInput}},{key:"keydown",value:function(u,l){u.shouldDeactivate(l)&&(u.tribute.isActive=!1,u.tribute.hideMenu());var s=this||o;u.commandEvent=!1,t.keys().forEach((function(o){o.key===l.keyCode&&(u.commandEvent=!0,u.callbacks()[o.value.toLowerCase()](l,s))}))}},{key:"input",value:function(u,l){u.inputEvent=!0,u.keyup.call(this||o,u,l)}},{key:"click",value:function(o,u){var l=o.tribute;if(l.menu&&l.menu.contains(u.target)){var s=u.target;for(u.preventDefault(),u.stopPropagation();"li"!==s.nodeName.toLowerCase();)if(!(s=s.parentNode)||s===l.menu)throw new Error("cannot find the <li> container for the click");l.selectItemAtIndex(s.getAttribute("data-index"),u),l.hideMenu()}else l.current.element&&!l.current.externalTrigger&&(l.current.externalTrigger=!1,setTimeout((function(){return l.hideMenu()})))}},{key:"keyup",value:function(u,l){if(u.inputEvent&&(u.inputEvent=!1),u.updateSelection(this||o),27!==l.keyCode){if(!u.tribute.allowSpaces&&u.tribute.hasTrailingSpace)return u.tribute.hasTrailingSpace=!1,u.commandEvent=!0,void u.callbacks().space(l,this||o);if(!u.tribute.isActive)if(u.tribute.autocompleteMode)u.callbacks().triggerChar(l,this||o,"");else{var s=u.getKeyCode(u,this||o,l);if(isNaN(s)||!s)return;var a=u.tribute.triggers().find((function(o){return o.charCodeAt(0)===s}));void 0!==a&&u.callbacks().triggerChar(l,this||o,a)}u.tribute.current.mentionText.length<u.tribute.current.collection.menuShowMinLength||((u.tribute.current.trigger||u.tribute.autocompleteMode)&&!1===u.commandEvent||u.tribute.isActive&&8===l.keyCode)&&u.tribute.showMenuFor(this||o,!0)}}},{key:"shouldDeactivate",value:function(u){if(!(this||o).tribute.isActive)return!1;if(0===(this||o).tribute.current.mentionText.length){var l=!1;return t.keys().forEach((function(o){u.keyCode===o.key&&(l=!0)})),!l}return!1}},{key:"getKeyCode",value:function(o,u,l){var s=o.tribute,a=s.range.getTriggerInfo(!1,s.hasTrailingSpace,!0,s.allowSpaces,s.autocompleteMode);return!!a&&a.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function(u){(this||o).tribute.current.element=u;var l=(this||o).tribute.range.getTriggerInfo(!1,(this||o).tribute.hasTrailingSpace,!0,(this||o).tribute.allowSpaces,(this||o).tribute.autocompleteMode);l&&((this||o).tribute.current.selectedPath=l.mentionSelectedPath,(this||o).tribute.current.mentionText=l.mentionText,(this||o).tribute.current.selectedOffset=l.mentionSelectedOffset)}},{key:"callbacks",value:function(){var u=this||o;return{triggerChar:function(o,l,s){var a=u.tribute;a.current.trigger=s;var c=a.collection.find((function(o){return o.trigger===s}));a.current.collection=c,a.current.mentionText.length>=a.current.collection.menuShowMinLength&&a.inputEvent&&a.showMenuFor(l,!0)},enter:function(o,l){u.tribute.isActive&&u.tribute.current.filteredItems&&(o.preventDefault(),o.stopPropagation(),setTimeout((function(){u.tribute.selectItemAtIndex(u.tribute.menuSelected,o),u.tribute.hideMenu()}),0))},escape:function(o,l){u.tribute.isActive&&(o.preventDefault(),o.stopPropagation(),u.tribute.isActive=!1,u.tribute.hideMenu())},tab:function(o,l){u.callbacks().enter(o,l)},space:function(o,l){u.tribute.isActive&&(u.tribute.spaceSelectsMatch?u.callbacks().enter(o,l):u.tribute.allowSpaces||(o.stopPropagation(),setTimeout((function(){u.tribute.hideMenu(),u.tribute.isActive=!1}),0)))},up:function(o,l){if(u.tribute.isActive&&u.tribute.current.filteredItems){o.preventDefault(),o.stopPropagation();var s=u.tribute.current.filteredItems.length,a=u.tribute.menuSelected;s>a&&a>0?(u.tribute.menuSelected--,u.setActiveLi()):0===a&&(u.tribute.menuSelected=s-1,u.setActiveLi(),u.tribute.menu.scrollTop=u.tribute.menu.scrollHeight)}},down:function(o,l){if(u.tribute.isActive&&u.tribute.current.filteredItems){o.preventDefault(),o.stopPropagation();var s=u.tribute.current.filteredItems.length-1,a=u.tribute.menuSelected;s>a?(u.tribute.menuSelected++,u.setActiveLi()):s===a&&(u.tribute.menuSelected=0,u.setActiveLi(),u.tribute.menu.scrollTop=0)}},delete:function(o,l){u.tribute.isActive&&u.tribute.current.mentionText.length<1?u.tribute.hideMenu():u.tribute.isActive&&u.tribute.showMenuFor(l)}}}},{key:"setActiveLi",value:function(u){var l=(this||o).tribute.menu.querySelectorAll("li"),s=l.length>>>0;u&&((this||o).tribute.menuSelected=parseInt(u));for(var a=0;a<s;a++){var c=l[a];if(a===(this||o).tribute.menuSelected){c.classList.add((this||o).tribute.current.collection.selectClass);var h=c.getBoundingClientRect(),d=(this||o).tribute.menu.getBoundingClientRect();if(h.bottom>d.bottom){var f=h.bottom-d.bottom;(this||o).tribute.menu.scrollTop+=f}else if(h.top<d.top){var m=d.top-h.top;(this||o).tribute.menu.scrollTop-=m}}else c.classList.remove((this||o).tribute.current.collection.selectClass)}}},{key:"getFullHeight",value:function(o,u){var l=o.getBoundingClientRect().height;if(u){var s=o.currentStyle||window.getComputedStyle(o);return l+parseFloat(s.marginTop)+parseFloat(s.marginBottom)}return l}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),t}(),l=function(){function t(u){e(this||o,t),(this||o).tribute=u,(this||o).tribute.menuEvents=this||o,(this||o).menu=(this||o).tribute.menu}return n(t,[{key:"bind",value:function(u){var l=this||o;(this||o).menuClickEvent=(this||o).tribute.events.click.bind(null,this||o),(this||o).menuContainerScrollEvent=this.debounce((function(){l.tribute.isActive&&l.tribute.showMenuFor(l.tribute.current.element,!1)}),300,!1),(this||o).windowResizeEvent=this.debounce((function(){l.tribute.isActive&&l.tribute.range.positionMenuAtCaret(!0)}),300,!1),(this||o).tribute.range.getDocument().addEventListener("MSPointerDown",(this||o).menuClickEvent,!1),(this||o).tribute.range.getDocument().addEventListener("mousedown",(this||o).menuClickEvent,!1),window.addEventListener("resize",(this||o).windowResizeEvent),(this||o).menuContainer?(this||o).menuContainer.addEventListener("scroll",(this||o).menuContainerScrollEvent,!1):window.addEventListener("scroll",(this||o).menuContainerScrollEvent)}},{key:"unbind",value:function(u){(this||o).tribute.range.getDocument().removeEventListener("mousedown",(this||o).menuClickEvent,!1),(this||o).tribute.range.getDocument().removeEventListener("MSPointerDown",(this||o).menuClickEvent,!1),window.removeEventListener("resize",(this||o).windowResizeEvent),(this||o).menuContainer?(this||o).menuContainer.removeEventListener("scroll",(this||o).menuContainerScrollEvent,!1):window.removeEventListener("scroll",(this||o).menuContainerScrollEvent)}},{key:"debounce",value:function(u,l,s){var a,c=arguments,h=this||o;return function(){var o=h,d=c,f=s&&!a;clearTimeout(a),a=setTimeout((function(){a=null,s||u.apply(o,d)}),l),f&&u.apply(o,d)}}}]),t}(),s=function(){function t(u){e(this||o,t),(this||o).tribute=u,(this||o).tribute.range=this||o}return n(t,[{key:"getDocument",value:function(){var u;return(this||o).tribute.current.collection&&(u=(this||o).tribute.current.collection.iframe),u?u.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(u){var l,s=this||o,a=(this||o).tribute.current,c=this.getTriggerInfo(!1,(this||o).tribute.hasTrailingSpace,!0,(this||o).tribute.allowSpaces,(this||o).tribute.autocompleteMode);if(void 0!==c){if(!(this||o).tribute.positionMenu)return void((this||o).tribute.menu.style.cssText="display: block;");l=this.isContentEditable(a.element)?this.getContentEditableCaretPosition(c.mentionPosition):this.getTextAreaOrInputUnderlinePosition((this||o).tribute.current.element,c.mentionPosition),(this||o).tribute.menu.style.cssText="top: ".concat(l.top,"px;\n                                     left: ").concat(l.left,"px;\n                                     right: ").concat(l.right,"px;\n                                     bottom: ").concat(l.bottom,"px;\n                                     position: absolute;\n                                     display: block;"),"auto"===l.left&&((this||o).tribute.menu.style.left="auto"),"auto"===l.top&&((this||o).tribute.menu.style.top="auto"),u&&this.scrollIntoView(),window.setTimeout((function(){var o={width:s.tribute.menu.offsetWidth,height:s.tribute.menu.offsetHeight},a=s.isMenuOffScreen(l,o),c=window.innerWidth>o.width&&(a.left||a.right),h=window.innerHeight>o.height&&(a.top||a.bottom);(c||h)&&(s.tribute.menu.style.cssText="display: none",s.positionMenuAtCaret(u))}),0)}else(this||o).tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(o,u,l){var s,a=o;if(u)for(var c=0;c<u.length;c++){if(void 0===(a=a.childNodes[u[c]]))return;for(;a.length<l;)l-=a.length,a=a.nextSibling;0!==a.childNodes.length||a.length||(a=a.previousSibling)}var h=this.getWindowSelection();(s=this.getDocument().createRange()).setStart(a,l),s.setEnd(a,l),s.collapse(!0);try{h.removeAllRanges()}catch(o){}h.addRange(s),o.focus()}},{key:"replaceTriggerText",value:function(u,l,s,a,c){var h=this.getTriggerInfo(!0,s,l,(this||o).tribute.allowSpaces,(this||o).tribute.autocompleteMode);if(void 0!==h){var d=(this||o).tribute.current,f=new CustomEvent("tribute-replaced",{detail:{item:c,instance:d,context:h,event:a}});if(this.isContentEditable(d.element)){u+="string"==typeof(this||o).tribute.replaceTextSuffix?(this||o).tribute.replaceTextSuffix:" ";var m=h.mentionPosition+h.mentionText.length;(this||o).tribute.autocompleteMode||(m+=h.mentionTriggerChar.length),this.pasteHtml(u,h.mentionPosition,m)}else{var v=(this||o).tribute.current.element,p="string"==typeof(this||o).tribute.replaceTextSuffix?(this||o).tribute.replaceTextSuffix:" ";u+=p;var g=h.mentionPosition,b=h.mentionPosition+h.mentionText.length+p.length;(this||o).tribute.autocompleteMode||(b+=h.mentionTriggerChar.length-1),v.value=v.value.substring(0,g)+u+v.value.substring(b,v.value.length),v.selectionStart=g+u.length,v.selectionEnd=g+u.length}d.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),d.element.dispatchEvent(f)}}},{key:"pasteHtml",value:function(o,u,l){var s,a;a=this.getWindowSelection(),(s=this.getDocument().createRange()).setStart(a.anchorNode,u),s.setEnd(a.anchorNode,l),s.deleteContents();var c=this.getDocument().createElement("div");c.innerHTML=o;for(var h,d,f=this.getDocument().createDocumentFragment();h=c.firstChild;)d=f.appendChild(h);s.insertNode(f),d&&((s=s.cloneRange()).setStartAfter(d),s.collapse(!0),a.removeAllRanges(),a.addRange(s))}},{key:"getWindowSelection",value:function(){return(this||o).tribute.collection.iframe?(this||o).tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(o){if(null===o.parentNode)return 0;for(var u=0;u<o.parentNode.childNodes.length;u++)if(o.parentNode.childNodes[u]===o)return u}},{key:"getContentEditableSelectedPath",value:function(o){var u=this.getWindowSelection(),l=u.anchorNode,s=[];if(null!=l){for(var a,c=l.contentEditable;null!==l&&"true"!==c;)a=this.getNodePositionInParent(l),s.push(a),null!==(l=l.parentNode)&&(c=l.contentEditable);return s.reverse(),{selected:l,path:s,offset:u.getRangeAt(0).startOffset}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var u=(this||o).tribute.current,l="";if(this.isContentEditable(u.element)){var s=this.getWindowSelection().anchorNode;if(null!=s){var a=s.textContent,c=this.getWindowSelection().getRangeAt(0).startOffset;a&&c>=0&&(l=a.substring(0,c))}}else{var h=(this||o).tribute.current.element;if(h){var d=h.selectionStart;h.value&&d>=0&&(l=h.value.substring(0,d))}}return l}},{key:"getLastWordInText",value:function(o){var u=(o=o.replace(/\u00A0/g," ")).split(/\s+/);return u[u.length-1].trim()}},{key:"getTriggerInfo",value:function(u,l,s,a,c){var h,d,f,m=this||o,v=(this||o).tribute.current;if(this.isContentEditable(v.element)){var p=this.getContentEditableSelectedPath(v);p&&(h=p.selected,d=p.path,f=p.offset)}else h=(this||o).tribute.current.element;var g=this.getTextPrecedingCurrentSelection(),b=this.getLastWordInText(g);if(c)return{mentionPosition:g.length-b.length,mentionText:b,mentionSelectedElement:h,mentionSelectedPath:d,mentionSelectedOffset:f};if(null!=g){var y,w=-1;if((this||o).tribute.collection.forEach((function(o){var u=o.trigger,l=o.requireLeadingSpace?m.lastIndexWithLeadingSpace(g,u):g.lastIndexOf(u);l>w&&(w=l,y=u,s=o.requireLeadingSpace)})),w>=0&&(0===w||!s||/[\xA0\s]/g.test(g.substring(w-1,w)))){var T=g.substring(w+y.length,g.length);y=g.substring(w,w+y.length);var C=T.substring(0,1),S=T.length>0&&(" "===C||" "===C);l&&(T=T.trim());var E=a?/[^\S ]/g:/[\xA0\s]/g;if((this||o).tribute.hasTrailingSpace=E.test(T),!S&&(u||!E.test(T)))return{mentionPosition:w,mentionText:T,mentionSelectedElement:h,mentionSelectedPath:d,mentionSelectedOffset:f,mentionTriggerChar:y}}}}},{key:"lastIndexWithLeadingSpace",value:function(o,u){for(var l=o.split("").reverse().join(""),s=-1,a=0,c=o.length;a<c;a++){for(var h=a===o.length-1,d=/\s/.test(l[a+1]),f=!0,m=u.length-1;m>=0;m--)if(u[m]!==l[a-m]){f=!1;break}if(f&&(h||d)){s=o.length-1-a;break}}return s}},{key:"isContentEditable",value:function(o){return"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName}},{key:"isMenuOffScreen",value:function(o,u){var l=window.innerWidth,s=window.innerHeight,a=document.documentElement,c=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),h=(window.pageYOffset||a.scrollTop)-(a.clientTop||0),d="number"==typeof o.top?o.top:h+s-o.bottom-u.height,f="number"==typeof o.right?o.right:o.left+u.width,m="number"==typeof o.bottom?o.bottom:o.top+u.height,v="number"==typeof o.left?o.left:c+l-o.right-u.width;return{top:d<Math.floor(h),right:f>Math.ceil(c+l),bottom:m>Math.ceil(h+s),left:v<Math.floor(c)}}},{key:"getMenuDimensions",value:function(){var u={width:null,height:null};return(this||o).tribute.menu.style.cssText="top: 0px;\n                                 left: 0px;\n                                 position: fixed;\n                                 display: block;\n                                 visibility; hidden;",u.width=(this||o).tribute.menu.offsetWidth,u.height=(this||o).tribute.menu.offsetHeight,(this||o).tribute.menu.style.cssText="display: none;",u}},{key:"getTextAreaOrInputUnderlinePosition",value:function(u,l,s){var a=null!==window.mozInnerScreenX,c=this.getDocument().createElement("div");c.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(c);var h=c.style,d=window.getComputedStyle?getComputedStyle(u):u.currentStyle;h.whiteSpace="pre-wrap","INPUT"!==u.nodeName&&(h.wordWrap="break-word"),h.position="absolute",h.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(o){h[o]=d[o]})),a?(h.width="".concat(parseInt(d.width)-2,"px"),u.scrollHeight>parseInt(d.height)&&(h.overflowY="scroll")):h.overflow="hidden",c.textContent=u.value.substring(0,l),"INPUT"===u.nodeName&&(c.textContent=c.textContent.replace(/\s/g," "));var f=this.getDocument().createElement("span");f.textContent=u.value.substring(l)||".",c.appendChild(f);var m=u.getBoundingClientRect(),v=document.documentElement,p=(window.pageXOffset||v.scrollLeft)-(v.clientLeft||0),g=(window.pageYOffset||v.scrollTop)-(v.clientTop||0),b=0,y=0;(this||o).menuContainerIsBody&&(b=m.top,y=m.left);var w={top:b+g+f.offsetTop+parseInt(d.borderTopWidth)+parseInt(d.fontSize)-u.scrollTop,left:y+p+f.offsetLeft+parseInt(d.borderLeftWidth)},T=window.innerWidth,C=window.innerHeight,S=this.getMenuDimensions(),E=this.isMenuOffScreen(w,S);E.right&&(w.right=T-w.left,w.left="auto");var k=(this||o).tribute.menuContainer?(this||o).tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(E.bottom){var x=k-(C-((this||o).tribute.menuContainer?(this||o).tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);w.bottom=x+(C-m.top-f.offsetTop),w.top="auto"}return(E=this.isMenuOffScreen(w,S)).left&&(w.left=T>S.width?p+T-S.width:p,delete w.right),E.top&&(w.top=C>S.height?g+C-S.height:g,delete w.bottom),this.getDocument().body.removeChild(c),w}},{key:"getContentEditableCaretPosition",value:function(u){var l,s=this.getWindowSelection();(l=this.getDocument().createRange()).setStart(s.anchorNode,u),l.setEnd(s.anchorNode,u),l.collapse(!1);var a=l.getBoundingClientRect(),c=document.documentElement,h=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),d=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),f={left:a.left+h,top:a.top+a.height+d},m=window.innerWidth,v=window.innerHeight,p=this.getMenuDimensions(),g=this.isMenuOffScreen(f,p);g.right&&(f.left="auto",f.right=m-a.left-h);var b=(this||o).tribute.menuContainer?(this||o).tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(g.bottom){var y=b-(v-((this||o).tribute.menuContainer?(this||o).tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);f.top="auto",f.bottom=y+(v-a.top)}return(g=this.isMenuOffScreen(f,p)).left&&(f.left=m>p.width?h+m-p.width:h,delete f.right),g.top&&(f.top=v>p.height?d+v-p.height:d,delete f.bottom),(this||o).menuContainerIsBody||(f.left=f.left?f.left-(this||o).tribute.menuContainer.offsetLeft:f.left,f.top=f.top?f.top-(this||o).tribute.menuContainer.offsetTop:f.top),f}},{key:"scrollIntoView",value:function(u){var l,s=(this||o).menu;if(void 0!==s){for(;void 0===l||0===l.height;)if(0===(l=s.getBoundingClientRect()).height&&(void 0===(s=s.childNodes[0])||!s.getBoundingClientRect))return;var a=l.top,c=a+l.height;if(a<0)window.scrollTo(0,window.pageYOffset+l.top-20);else if(c>window.innerHeight){var h=window.pageYOffset+l.top-20;h-window.pageYOffset>100&&(h=window.pageYOffset+100);var d=window.pageYOffset-(window.innerHeight-c);d>h&&(d=h),window.scrollTo(0,d)}}}},{key:"menuContainerIsBody",get:function(){return(this||o).tribute.menuContainer===document.body||!(this||o).tribute.menuContainer}}]),t}(),a=function(){function t(u){e(this||o,t),(this||o).tribute=u,(this||o).tribute.search=this||o}return n(t,[{key:"simpleFilter",value:function(u,l){var s=this||o;return l.filter((function(o){return s.test(u,o)}))}},{key:"test",value:function(o,u){return null!==this.match(o,u)}},{key:"match",value:function(o,u,l){l=l||{};u.length;var s=l.pre||"",a=l.post||"",c=l.caseSensitive&&u||u.toLowerCase();if(l.skip)return{rendered:u,score:0};o=l.caseSensitive&&o||o.toLowerCase();var h=this.traverse(c,o,0,0,[]);return h?{rendered:this.render(u,h.cache,s,a),score:h.score}:null}},{key:"traverse",value:function(o,u,l,s,a){if(u.length===s)return{score:this.calculateScore(a),cache:a.slice()};if(!(o.length===l||u.length-s>o.length-l)){for(var c,h,d=u[s],f=o.indexOf(d,l);f>-1;){if(a.push(f),h=this.traverse(o,u,f+1,s+1,a),a.pop(),!h)return c;(!c||c.score<h.score)&&(c=h),f=o.indexOf(d,f+1)}return c}}},{key:"calculateScore",value:function(o){var u=0,l=1;return o.forEach((function(s,a){a>0&&(o[a-1]+1===s?l+=l+1:l=1),u+=l})),u}},{key:"render",value:function(o,u,l,s){var a=o.substring(0,u[0]);return u.forEach((function(c,h){a+=l+o[c]+s+o.substring(c+1,u[h+1]?u[h+1]:o.length)})),a}},{key:"filter",value:function(u,l,s){var a=this||o;return s=s||{},l.reduce((function(o,l,c,h){var d=l;s.extract&&((d=s.extract(l))||(d=""));var f=a.match(u,d,s);return null!=f&&(o[o.length]={string:f.rendered,score:f.score,index:c,original:l}),o}),[]).sort((function(o,u){var l=u.score-o.score;return l||o.index-u.index}))}}]),t}();return function(){function t(c){var h,d=this||o,f=c.values,m=void 0===f?null:f,v=c.iframe,p=void 0===v?null:v,g=c.selectClass,b=void 0===g?"highlight":g,y=c.containerClass,w=void 0===y?"tribute-container":y,T=c.itemClass,C=void 0===T?"":T,S=c.trigger,E=void 0===S?"@":S,k=c.autocompleteMode,x=void 0!==k&&k,M=c.selectTemplate,A=void 0===M?null:M,L=c.menuItemTemplate,I=void 0===L?null:L,N=c.lookup,O=void 0===N?"key":N,D=c.fillAttr,P=void 0===D?"value":D,R=c.collection,W=void 0===R?null:R,H=c.menuContainer,B=void 0===H?null:H,F=c.noMatchTemplate,_=void 0===F?null:F,j=c.requireLeadingSpace,Y=void 0===j||j,z=c.allowSpaces,K=void 0!==z&&z,q=c.replaceTextSuffix,U=void 0===q?null:q,X=c.positionMenu,Q=void 0===X||X,V=c.spaceSelectsMatch,G=void 0!==V&&V,J=c.searchOpts,Z=void 0===J?{}:J,$=c.menuItemLimit,ee=void 0===$?null:$,te=c.menuShowMinLength,ne=void 0===te?0:te;if(e(this||o,t),(this||o).autocompleteMode=x,(this||o).menuSelected=0,(this||o).current={},(this||o).inputEvent=!1,(this||o).isActive=!1,(this||o).menuContainer=B,(this||o).allowSpaces=K,(this||o).replaceTextSuffix=U,(this||o).positionMenu=Q,(this||o).hasTrailingSpace=!1,(this||o).spaceSelectsMatch=G,(this||o).autocompleteMode&&(E="",K=!1),m)(this||o).collection=[{trigger:E,iframe:p,selectClass:b,containerClass:w,itemClass:C,selectTemplate:(A||t.defaultSelectTemplate).bind(this||o),menuItemTemplate:(I||t.defaultMenuItemTemplate).bind(this||o),noMatchTemplate:(h=_,"string"==typeof h?""===h.trim()?null:h:"function"==typeof h?h.bind(d):_||function(){return"<li>No Match Found!</li>"}.bind(d)),lookup:O,fillAttr:P,values:m,requireLeadingSpace:Y,searchOpts:Z,menuItemLimit:ee,menuShowMinLength:ne}];else{if(!W)throw new Error("[Tribute] No collection specified.");(this||o).autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),(this||o).collection=W.map((function(o){return{trigger:o.trigger||E,iframe:o.iframe||p,selectClass:o.selectClass||b,containerClass:o.containerClass||w,itemClass:o.itemClass||C,selectTemplate:(o.selectTemplate||t.defaultSelectTemplate).bind(d),menuItemTemplate:(o.menuItemTemplate||t.defaultMenuItemTemplate).bind(d),noMatchTemplate:function(o){return"string"==typeof o?""===o.trim()?null:o:"function"==typeof o?o.bind(d):_||function(){return"<li>No Match Found!</li>"}.bind(d)}(_),lookup:o.lookup||O,fillAttr:o.fillAttr||P,values:o.values,requireLeadingSpace:o.requireLeadingSpace,searchOpts:o.searchOpts||Z,menuItemLimit:o.menuItemLimit||ee,menuShowMinLength:o.menuShowMinLength||ne}}))}new s(this||o),new u(this||o),new l(this||o),new a(this||o)}return n(t,[{key:"triggers",value:function(){return(this||o).collection.map((function(o){return o.trigger}))}},{key:"attach",value:function(o){if(!o)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&o instanceof jQuery&&(o=o.get()),o.constructor===NodeList||o.constructor===HTMLCollection||o.constructor===Array)for(var u=o.length,l=0;l<u;++l)this._attach(o[l]);else this._attach(o)}},{key:"_attach",value:function(u){u.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+u.nodeName),this.ensureEditable(u),(this||o).events.bind(u),u.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function(o){if(-1===t.inputTypes().indexOf(o.nodeName)){if(!o.contentEditable)throw new Error("[Tribute] Cannot bind to "+o.nodeName);o.contentEditable=!0}}},{key:"createMenu",value:function(u){var l=(this||o).range.getDocument().createElement("div"),s=(this||o).range.getDocument().createElement("ul");return l.className=u,l.appendChild(s),(this||o).menuContainer?(this||o).menuContainer.appendChild(l):(this||o).range.getDocument().body.appendChild(l)}},{key:"showMenuFor",value:function(u,l){var s=this||o;if(!(this||o).isActive||(this||o).current.element!==u||(this||o).current.mentionText!==(this||o).currentMentionTextSnapshot){(this||o).currentMentionTextSnapshot=(this||o).current.mentionText,(this||o).menu||((this||o).menu=this.createMenu((this||o).current.collection.containerClass),u.tributeMenu=(this||o).menu,(this||o).menuEvents.bind((this||o).menu)),(this||o).isActive=!0,(this||o).menuSelected=0,(this||o).current.mentionText||((this||o).current.mentionText="");var r=function(o){if(s.isActive){var u=s.search.filter(s.current.mentionText,o,{pre:s.current.collection.searchOpts.pre||"<span>",post:s.current.collection.searchOpts.post||"</span>",skip:s.current.collection.searchOpts.skip,extract:function(o){if("string"==typeof s.current.collection.lookup)return o[s.current.collection.lookup];if("function"==typeof s.current.collection.lookup)return s.current.collection.lookup(o,s.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});s.current.collection.menuItemLimit&&(u=u.slice(0,s.current.collection.menuItemLimit)),s.current.filteredItems=u;var a=s.menu.querySelector("ul");if(s.range.positionMenuAtCaret(l),!u.length){var c=new CustomEvent("tribute-no-match",{detail:s.menu});return s.current.element.dispatchEvent(c),void("function"==typeof s.current.collection.noMatchTemplate&&!s.current.collection.noMatchTemplate()||!s.current.collection.noMatchTemplate?s.hideMenu():"function"==typeof s.current.collection.noMatchTemplate?a.innerHTML=s.current.collection.noMatchTemplate():a.innerHTML=s.current.collection.noMatchTemplate)}a.innerHTML="";var h=s.range.getDocument().createDocumentFragment();u.forEach((function(o,u){var l=s.range.getDocument().createElement("li");l.setAttribute("data-index",u),l.className=s.current.collection.itemClass,l.addEventListener("mousemove",(function(o){var u=i(s._findLiTarget(o.target),2),l=(u[0],u[1]);0!==o.movementY&&s.events.setActiveLi(l)})),s.menuSelected===u&&l.classList.add(s.current.collection.selectClass),l.innerHTML=s.current.collection.menuItemTemplate(o),h.appendChild(l)})),a.appendChild(h)}};"function"==typeof(this||o).current.collection.values?(this||o).current.collection.values((this||o).current.mentionText,r):r((this||o).current.collection.values)}}},{key:"_findLiTarget",value:function(o){if(!o)return[];var u=o.getAttribute("data-index");return u?[o,u]:this._findLiTarget(o.parentNode)}},{key:"showMenuForCollection",value:function(u,l){u!==document.activeElement&&this.placeCaretAtEnd(u),(this||o).current.collection=(this||o).collection[l||0],(this||o).current.externalTrigger=!0,(this||o).current.element=u,u.isContentEditable?this.insertTextAtCursor((this||o).current.collection.trigger):this.insertAtCaret(u,(this||o).current.collection.trigger),this.showMenuFor(u)}},{key:"placeCaretAtEnd",value:function(o){if(o.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var u=document.createRange();u.selectNodeContents(o),u.collapse(!1);var l=window.getSelection();l.removeAllRanges(),l.addRange(u)}else if(void 0!==document.body.createTextRange){var s=document.body.createTextRange();s.moveToElementText(o),s.collapse(!1),s.select()}}},{key:"insertTextAtCursor",value:function(o){var u,l;(l=(u=window.getSelection()).getRangeAt(0)).deleteContents();var s=document.createTextNode(o);l.insertNode(s),l.selectNodeContents(s),l.collapse(!1),u.removeAllRanges(),u.addRange(l)}},{key:"insertAtCaret",value:function(o,u){var l=o.scrollTop,s=o.selectionStart,a=o.value.substring(0,s),c=o.value.substring(o.selectionEnd,o.value.length);o.value=a+u+c,s+=u.length,o.selectionStart=s,o.selectionEnd=s,o.focus(),o.scrollTop=l}},{key:"hideMenu",value:function(){(this||o).menu&&((this||o).menu.style.cssText="display: none;",(this||o).isActive=!1,(this||o).menuSelected=0,(this||o).current={})}},{key:"selectItemAtIndex",value:function(u,l){if("number"==typeof(u=parseInt(u))&&!isNaN(u)){var s=(this||o).current.filteredItems[u],a=(this||o).current.collection.selectTemplate(s);null!==a&&this.replaceText(a,l,s)}}},{key:"replaceText",value:function(u,l,s){(this||o).range.replaceTriggerText(u,!0,!0,l,s)}},{key:"_append",value:function(o,u,l){if("function"==typeof o.values)throw new Error("Unable to append to values, as it is a function.");o.values=l?u:o.values.concat(u)}},{key:"append",value:function(u,l,s){var a=parseInt(u);if("number"!=typeof a)throw new Error("please provide an index for the collection to update.");var c=(this||o).collection[a];this._append(c,l,s)}},{key:"appendCurrent",value:function(u,l){if(!(this||o).isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append((this||o).current.collection,u,l)}},{key:"detach",value:function(o){if(!o)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&o instanceof jQuery&&(o=o.get()),o.constructor===NodeList||o.constructor===HTMLCollection||o.constructor===Array)for(var u=o.length,l=0;l<u;++l)this._detach(o[l]);else this._detach(o)}},{key:"_detach",value:function(u){var l=this||o;(this||o).events.unbind(u),u.tributeMenu&&(this||o).menuEvents.unbind(u.tributeMenu),setTimeout((function(){u.removeAttribute("data-tribute"),l.isActive=!1,u.tributeMenu&&u.tributeMenu.remove()}))}},{key:"isActive",get:function(){return(this||o)._isActive},set:function(u){if((this||o)._isActive!=u&&((this||o)._isActive=u,(this||o).current.element)){var l=new CustomEvent("tribute-active-".concat(u));(this||o).current.element.dispatchEvent(l)}}}],[{key:"defaultSelectTemplate",value:function(u){return void 0===u?"".concat((this||o).current.collection.trigger).concat((this||o).current.mentionText):(this||o).range.isContentEditable((this||o).current.element)?'<span class="tribute-mention">'+((this||o).current.collection.trigger+u.original[(this||o).current.collection.fillAttr])+"</span>":(this||o).current.collection.trigger+u.original[(this||o).current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(o){return o.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),t}()}));var l=u;export default l;

